<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leap</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            width: calc(100% / 7);
            height: 75px; /* set height to whatever  */
        }

        th {
            background-color: #e74c3c;
        }

        .month-year {
            text-align: center;
            margin-bottom: 10px;
        }

        button {
            cursor: pointer;
        }
        
        h1 {
            color: #e74c3c; /* change the color of the h1 element */
        }
    </style>
</head>
<body>
    <h1>Leap</h1>

    <div class="month-year">
        <button onclick="prevMonth()">Previous</button>
        <span id="currentMonthYear"></span>
        <button onclick="nextMonth()">Next</button>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Sun</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
            </tr>
        </thead>
        <tbody id="calendarBody">
            <!-- Calendar content will be dynamically generated here -->
        </tbody>
    </table>

    <script>
        // Initial values for the current month and year
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedCell; // To store the clicked cell
    
        // Function to update the calendar based on the current month and year
        function updateCalendar() {
            const calendarBody = document.getElementById('calendarBody');
            const currentMonthYear = document.getElementById('currentMonthYear');
    
            // Clear the previous content
            calendarBody.innerHTML = '';
    
            // Set the current month and year
            currentMonthYear.textContent = `${new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long' })} ${currentYear}`;
    
            // Get the first day of the month and the total number of days in the month
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const lastDay = new Date(currentYear, currentMonth + 1, 0).getDate();
    
            // Create the calendar rows
            let row = calendarBody.insertRow();
            for (let i = 0; i < firstDay; i++) {
                row.insertCell();
            }
    
            for (let day = 1; day <= lastDay; day++) {
                (function(day) { // IIFE to capture current day
                    const cell = row.insertCell();
                    cell.textContent = day;
                    cell.addEventListener('click', function() {
                        openPopup(day);
                    });
                })(day);
    
                if (row.cells.length === 7) {
                    row = calendarBody.insertRow();
                }
            }
        }
    
    function openPopup(day) {
        const popupWindow = window.open('', '_blank', 'width=400,height=200');
        popupWindow.document.write(`
            <h2>Enter Details for ${currentYear}-${currentMonth + 1}-${day}</h2>
            <form id="popupForm" action="addEvent.php" method="POST">
            <input type="hidden" id="date" name="date" value="${currentYear}-${currentMonth + 1}-${day}">
            <label for="name">Name:</label><br>
            <input type="text" id="name" name="name"><br>
            <label for="location">Location:</label><br>
            <input type="text" id="location" name="location"><br>
            <label for="notes">Notes:</label><br>
            <textarea id="notes" name="notes"></textarea><br><br>
            <input type="submit" value="Submit">
        </form>
    `);
    popupWindow.document.close(); // Ensure the document is fully written

            
popupWindow.submitEventForm = function() {
    const form = popupWindow.document.getElementById('popupForm');
    const formData = new FormData(form);

    //formData.append('user_id', sessionStorage.getItem('user_id')); 

    fetch('addEvent.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.text())
    .then(data => {
        console.log('Success:', data);
        // You can add success handling here, e.g., update UI
        popupWindow.close();
    })
    .catch((error) => {
        console.error('Error:', error);
    });

    return false; // Prevent form submission
}

popupWindow.document.getElementById('popupForm').onsubmit = function() {
    return popupWindow.submitEventForm();
}

    }        
    
        // Function to go to the previous month
        function prevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateCalendar();
        }
    
        // Function to go to the next month
        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateCalendar();
        }
    
        // Initial calendar setup
        updateCalendar();
    </script>
    
    
    
    
</body>
</html>
